"use strict";(globalThis.webpackChunkbook=globalThis.webpackChunkbook||[]).push([[518],{518:(e,s,t)=>{t.r(s),t.d(s,{default:()=>j});var n=t(6540);const a={chatButton:"chatButton_pfNJ",chatWindow:"chatWindow_jOju",slideUp:"slideUp_qoHh",chatHeader:"chatHeader_HRf2",headerButtons:"headerButtons_ybPG",clearButton:"clearButton_jwhp",closeButton:"closeButton_rPRi",messageList:"messageList_MMja",message:"message_QLuY",userMessage:"userMessage_WYIQ",assistantMessage:"assistantMessage_DVKn",sources:"sources_QPLs",sourceItem:"sourceItem_Bua4",sourceScore:"sourceScore_JIr1",inputArea:"inputArea_pfU2",sendButton:"sendButton_oDVz",loadingIndicator:"loadingIndicator_njND",loadingDot:"loadingDot_KA3G",bounce:"bounce_vODZ",errorMessage:"errorMessage_hXX5",textSelectionBanner:"textSelectionBanner_WmX2",clearTextButton:"clearTextButton_daNO"};var o=t(4848);function r({onClick:e,isOpen:s}){return(0,o.jsx)("button",{className:a.chatButton,onClick:e,"aria-label":s?"Close chat":"Open chat",title:s?"Close chat":"Ask a question",children:s?"\u2715":"\ud83d\udcac"})}function l(e){let s=e.replace(/\.(mdx?|md)$/,"");return s=s.replace(/\/index$/,""),`/ai-native-book/docs/${s}`}function c({sources:e}){return 0===e.length?null:(0,o.jsxs)("div",{className:a.sources,children:[(0,o.jsx)("h4",{children:"\ud83d\udcda Sources:"}),e.map((e,s)=>(0,o.jsxs)("div",{className:a.sourceItem,children:[(0,o.jsx)("a",{href:l(e.file_path),target:"_blank",rel:"noopener noreferrer",children:e.title}),(0,o.jsxs)("span",{className:a.sourceScore,children:["(",Math.round(100*e.relevance_score),"% relevant)"]})]},`${e.file_path}-${s}`))]})}function i({messages:e}){const s=(0,n.useRef)(null);return(0,n.useEffect)(()=>{s.current?.scrollIntoView({behavior:"smooth"})},[e]),(0,o.jsxs)("div",{className:a.messageList,role:"log","aria-live":"polite",children:[0===e.length&&(0,o.jsxs)("div",{style:{textAlign:"center",color:"var(--ifm-color-emphasis-600)",padding:"20px"},children:[(0,o.jsx)("p",{children:"\ud83d\udc4b Welcome to the Physical AI & Humanoid Robotics chatbot!"}),(0,o.jsx)("p",{style:{fontSize:"14px"},children:"Ask me anything about the book content."})]}),e.map((e,s)=>(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:`${a.message} ${"user"===e.role?a.userMessage:a.assistantMessage}`,children:e.content}),"assistant"===e.role&&e.sources&&(0,o.jsx)(c,{sources:e.sources})]},s)),(0,o.jsx)("div",{ref:s})]})}function d({onSend:e,disabled:s}){const[t,r]=(0,n.useState)(""),l=()=>{t.trim()&&!s&&(e(t.trim()),r(""))};return(0,o.jsxs)("div",{className:a.inputArea,children:[(0,o.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),l())},placeholder:"Ask a question...",disabled:s,maxLength:1e3,"aria-label":"Chat message input"}),(0,o.jsx)("button",{className:a.sendButton,onClick:l,disabled:s||!t.trim(),"aria-label":"Send message",children:"Send"})]})}function u(){return(0,o.jsxs)("div",{className:a.loadingIndicator,children:[(0,o.jsx)("div",{className:a.loadingDot}),(0,o.jsx)("div",{className:a.loadingDot}),(0,o.jsx)("div",{className:a.loadingDot})]})}function h({message:e,onRetry:s}){return(0,o.jsxs)("div",{className:a.errorMessage,children:[(0,o.jsx)("div",{children:e}),s&&(0,o.jsx)("button",{onClick:s,style:{marginTop:"8px",padding:"6px 12px",background:"var(--ifm-color-danger)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Retry"})]})}function g({selectedText:e,onClear:s}){if(!e)return null;const t=e.length>100?e.substring(0,100)+"...":e;return(0,o.jsxs)("div",{className:a.textSelectionBanner,children:[(0,o.jsxs)("span",{children:['\ud83d\udcdd Using selected text: "',t,'"']}),(0,o.jsx)("button",{className:a.clearTextButton,onClick:s,"aria-label":"Clear selected text",children:"\u2715"})]})}function m({messages:e,onClose:s,onSend:t,isLoading:n,error:r,onRetry:l,selectedText:c,onClearSelection:m,onClearChat:x}){return(0,o.jsxs)("div",{className:a.chatWindow,role:"dialog","aria-label":"Chat window",children:[(0,o.jsxs)("div",{className:a.chatHeader,children:[(0,o.jsx)("h3",{children:"\ud83d\udcac Chat Assistant"}),(0,o.jsxs)("div",{className:a.headerButtons,children:[(0,o.jsx)("button",{className:a.clearButton,onClick:x,"aria-label":"Clear chat history",title:"Clear chat history",children:"\ud83d\uddd1\ufe0f"}),(0,o.jsx)("button",{className:a.closeButton,onClick:s,"aria-label":"Close chat",children:"\u2715"})]})]}),c&&(0,o.jsx)(g,{selectedText:c,onClear:m}),(0,o.jsx)(i,{messages:e}),n&&(0,o.jsx)(u,{}),r&&(0,o.jsx)(h,{message:r,onRetry:l}),(0,o.jsx)(d,{onSend:t,disabled:n})]})}const x="https://chatapi-production-ea84.up.railway.app";const p="rag_chatbot_session";function j(){const[e,s]=(0,n.useState)(!1),[t,a]=(0,n.useState)([]),[l,c]=(0,n.useState)(null),[i,d]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),[g,j]=(0,n.useState)(""),[f,v]=(0,n.useState)("");(0,n.useEffect)(()=>{const e=localStorage.getItem(p);if(e)try{const{sessionId:s,messages:t}=JSON.parse(e);c(s),a(t)}catch(s){console.error("Failed to load session:",s)}},[]),(0,n.useEffect)(()=>{l&&t.length>0&&localStorage.setItem(p,JSON.stringify({sessionId:l,messages:t}))},[l,t]),(0,n.useEffect)(()=>{const e=()=>{const e=window.getSelection(),s=e?.toString().trim()||"";s.length>=1&&s.length<=1e3?j(s):s.length>1e3&&j("")};return document.addEventListener("mouseup",e),document.addEventListener("touchend",e),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e)}},[]);const b=async e=>{v(e),h(null),d(!0);const s={role:"user",content:e};a(e=>[...e,s]);try{const s={message:e,session_id:l||void 0,selected_text:g||void 0},t=await async function(e){try{const s=await fetch(`${x}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const e=await s.json();throw new Error(e.detail||"Failed to send message")}return await s.json()}catch(u){throw console.error("API error:",u),u}}(s);l||c(t.session_id);const n={role:"assistant",content:t.message,sources:t.sources};a(e=>[...e,n]),j("")}catch(t){console.error("Failed to send message:",t),h("Failed to get response. Please check your connection and try again."),a(e=>e.slice(0,-1))}finally{d(!1)}};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r,{onClick:()=>s(!e),isOpen:e}),e&&(0,o.jsx)(m,{messages:t,onClose:()=>s(!1),onSend:b,isLoading:i,error:u,onRetry:()=>{f&&b(f)},selectedText:g,onClearSelection:()=>{j("")},onClearChat:()=>{a([]),c(null),h(null),j(""),v(""),localStorage.removeItem(p)}})]})}}}]);